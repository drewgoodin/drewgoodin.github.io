<!DOCTYPE HTML>
<html lang='EN-US'>
  <head>
    <meta charset = "UTF-8">
    <title>Drew K Goodin</title>
    <meta name = "viewport" content = "width=device-width">
    <meta name = "viewport" content = "initial-scale=1.0">
    <link rel = "stylesheet"
      type = "text/css"
      href = "/style.css" />
  </head>
  <body>
<p><a href="/blog.html">Blog home</a></p>

<h2>Code Organization for Go(lang)</h2>

<p>The main concerns with organizing Go projects seem to be code modularity/re-usability (how easy is it to use your application packages elsewhere?), and dependency resolution. Here are my notes on the former.</p>

<p>This assumes that you're familiar enough with Go to know about $GOPATH and the three directories that live there, as well as Go's suggestion (but not requirement) that paths to source files be in the form of a remote repository URL. If not, see <a href="https://golang.org/doc/code.html">How to Write Go Code</a>.</p>

<p>The goal is to organize the application in such a way that it is just as easy to fetch for the purpose of its main package (i.e. obtaining the executable(s)) as it is to use its supporting package(s) for other applications.</p>

<p>In filling this requirement, the key thing to note is that every directory under src/ can only contain Go files for a single package (as far as the <code>go</code> tool - i.e. <code>build</code>, <code>install</code>, or <code>get</code> - is concerned). This is why you might not want to place your main package in the top level directory of your application. It will work fine, but if you wanted to do something like <code>go get github.com/user/myapp</code> in order to use your application <em>as a library</em> for another application, it might not work: Since only one package can reside at top-level, all of your supporting package code would live in a subdirectory, say myapp/lib. When the previous <code>go get</code> command is run, the <code>myapp</code> binary is installed (since only the main package resides at the requested resource), and, <strong><em>presuming that the main package depends on all the packages you have under myapp/lib</em></strong>, you'll have all your supporting packages installed as well. Then, using your myapp packages in another application would require import statements like <code>import github.com/user/myapp/lib/foo</code>.</p>

<p>The alternative is to place your supporting package files at the top level, and your main package in a subdirectory like "myapp/cmd/myapp". Then, using <code>go get github.com/user/myapp</code> will fetch non-main packages only, and no binaries will be installed. If you also wanted the binary, just use <code>go get github.com/user/myapp/...</code>, which will allow <code>go</code> to recurse down the tree.</p>

<p>Here's an example src/ directory containing a single app called banana, which contains a single "banana" package spread out into two different source files, and a couple of binaries, which would be installed as banana-run1 and banana-run2.</p>

<pre><code>src/
    github.com/
        goodin1/
            banana/
                some_functions.go
                some_types.go
                cmd/
                    banana-run1/
                        main.go
                    banana-run2/
                        main.go
</code></pre>

<p>The main.go files would not have to be named as such; they would just need to both be of "package main" and contain main functions.</p>

<p>Just need the banana library?</p>

<pre><code>go get github.com/goodind1/banana

import github.com/goodind1/banana
</code></pre>

<p>Need the binaries too?</p>

<pre><code>go get github.com/goodind1/banana/...
</code></pre>
  </body>
</html>
