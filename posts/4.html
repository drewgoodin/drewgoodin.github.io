<!DOCTYPE HTML>
<html lang='EN-US'>
  <head>
    <meta charset = "UTF-8">
    <title>
A Multiplexed Bash Shell in Windows

</title>
    <meta name = "viewport" content = "width=device-width">
    <meta name = "viewport" content = "initial-scale=1.0">
    <link rel = "stylesheet"
      type = "text/css"
      href = "/style.css" />
  </head>
  <body>
<p><a href="/blog.html">Blog home</a></p>

<h2>A Multiplexed Bash Shell in Windows</h2>

<p>I'm trying <a href="https://docs.microsoft.com/en-us/windows/wsl/about">WSL</a> out for a while on a new Windows 10 machine. Here is a solution for getting the terminal environment close to what I'm used to in Linux, which is a simple split session via tmux.</p>

<p>In WSL, tmux 2.1 is installed by default.  I like just two vertical panes - one for file editing and one for normal shell interaction. When I open a WSL terminal session, I'd like it to pop right into that environment. Here's a way to do this:</p>

<p>On the WSL side, I have a very basic .tmux.conf file in my home directory, which is invoked when tmux is started. It just sets up my vertical panes, sets vi key bindings, and ensures that my terminal colors are preserved:</p>

<p>~/.tmux.conf:</p>

<pre><code>set-option -g status-keys vi
set-option -gw mode-keys vi
set -g default-terminal "screen-256color"
new
splitw -h
</code></pre>

<p>To start tmux with these settings, the shell command is "tmux attach", and not just "tmux" (the .tmux.conf file has created a new session to replace the one created automatically by tmux, and we need to attach that session).</p>

<p>Back on the Windows side, a simple PowerShell profile script will ensure that tmux starts whenever WSL does. It's crucial that the script is located in the spot where PowerShell looks for your profile startup script, and that your system Execution Policy allows PowerShell to run scripts. Verify this location by running "$profile" in PowerShell.</p>

<p>\Documents\WindowsPowerShell\Microsoft.Powershell_profile.ps1:</p>

<pre><code>function Bash_fn {
    if ($args) {
        $dir = $args[0]
        bash -c 'cd $dir; tmux attach'
    }
    else {
        bash -c 'tmux attach'
    }
}

New-alias tmux Bash_fn
</code></pre>

<p>This script creates an alias so that when "tmux" is entered in PowerShell, WSL is invoked along with  a command - "tmux attach". I'm thrown directly into my preferred Linux environment. It also takes an optional argument - a directory - and if this argument is provided, bash cd's into it before starting tmux. This way, since tmux is starting with two panes, I don't have to change directories on each pane individually. When tmux exits, so does bash (the -c switch functions this way), and I'm sent back to PowerShell.</p>
  </body>
</html>
